!function(t,e){var a=/^([0-9]{1,3})Â°\s*([0-9]{1,3})'\s*(([0-9]{1,3}(\.([0-9]{1,2}))?)"\s*)?([NEOSW]?)$/,n={decimal:{},sexagesimal:{},distance:0,getKeys:function(t){return{latitude:t.hasOwnProperty("lat")?"lat":"latitude",longitude:(!t.hasOwnProperty("lng")?!!t.hasOwnProperty("long")&&"long":"lng")||"longitude",elevation:(!t.hasOwnProperty("alt")?!!t.hasOwnProperty("altitude")&&"altitude":"alt")||!!t.hasOwnProperty("elev")&&"elev"||"elevation"}},getDistance:function(t,e,a){var r=n.getKeys(t),o=r.latitude,i=r.longitude,l=r.elevation;a=Math.floor(a)||1;var s={},u={};s[o]=n.useDecimal(t[o]),s[i]=n.useDecimal(t[i]),u[o]=n.useDecimal(e[o]),u[i]=n.useDecimal(e[i]);var g,c=6378137,h=6356752.314245,d=1/298.257223563,m=(u[i]-s[i]).toRad(),v=Math.atan((1-d)*Math.tan(parseFloat(s[o]).toRad())),f=Math.atan((1-d)*Math.tan(parseFloat(u[o]).toRad())),M=Math.sin(v),p=Math.cos(v),x=Math.sin(f),D=Math.cos(f),E=m,y=100;do{var b=Math.sin(E),R=Math.cos(E),N=Math.sqrt(D*b*(D*b)+(p*x-M*D*R)*(p*x-M*D*R));if(0==N)return n.distance=0;var S=M*x+p*D*R,w=Math.atan2(N,S),P=p*D*b/N,k=1-P*P,F=S-2*M*x/k;isNaN(F)&&(F=0);var L=d/16*k*(4+d*(4-3*k));g=E,E=m+(1-L)*d*P*(w+L*N*(F+L*S*(2*F*F-1)))}while(Math.abs(E-g)>1e-12&&--y>0);if(0==y)return NaN;var W=k*(c*c-h*h)/(h*h),K=W/1024*(256+W*(W*(74-47*W)-128)),O=h*(1+W/16384*(4096+W*(W*(320-175*W)-768)))*(w-K*N*(F+K/4*(S*(2*F*F-1)-K/6*F*(4*N*N-3)*(4*F*F-3))));if(O=O.toFixed(3),t.hasOwnProperty(l)&&e.hasOwnProperty(l)){var I=Math.abs(t[l]-e[l]);O=Math.sqrt(O*O+I*I)}return n.distance=Math.floor(Math.round(O/a)*a)},getDistanceSimple:function(t,e,a){var r=n.getKeys(t),o=r.latitude,i=r.longitude;a=Math.floor(a)||1;var l={},s={};l[o]=parseFloat(n.useDecimal(t[o])).toRad(),l[i]=parseFloat(n.useDecimal(t[i])).toRad(),s[o]=parseFloat(n.useDecimal(e[o])).toRad(),s[i]=parseFloat(n.useDecimal(e[i])).toRad();var u=Math.round(6378137*Math.acos(Math.sin(s[o])*Math.sin(l[o])+Math.cos(s[o])*Math.cos(l[o])*Math.cos(l[i]-s[i])));return n.distance=Math.floor(Math.round(u/a)*a)},getCenter:function(t){if(!t.length)return!1;var e=n.getKeys(t[0]),a=e.latitude,r=e.longitude,o=function(t){return Math.max.apply(Math,t)},i=function(t){return Math.min.apply(Math,t)},l={lat:[],lng:[]};for(var s in t)l.lat.push(n.useDecimal(t[s][a])),l.lng.push(n.useDecimal(t[s][r]));var u=i(l.lat),g=i(l.lng),c=o(l.lat),h=o(l.lng);return{latitude:((u+c)/2).toFixed(6),longitude:((g+h)/2).toFixed(6),distance:n.convertUnit("km",n.getDistance({lat:u,lng:g},{lat:c,lng:h}))}},getBounds:function(t){if(!t.length)return!1;var e=n.getKeys(t[0]),a=e.latitude,r=e.longitude,o=e.elevation,i=t[0].hasOwnProperty(o),l={maxLat:0,minLat:1/0,maxLng:0,minLng:1/0};i&&(l.maxElev=0,l.minElev=1/0);for(var s=0,u=t.length;s<u;++s)l.maxLat=Math.max(t[s][a],l.maxLat),l.minLat=Math.min(t[s][a],l.minLat),l.maxLng=Math.max(t[s][r],l.maxLng),l.minLng=Math.min(t[s][r],l.minLng),i&&(l.maxElev=Math.max(t[s][o],l.maxElev),l.minElev=Math.min(t[s][o],l.minElev));return l},isPointInside:function(t,e){for(var a=n.getKeys(t),r=a.latitude,o=a.longitude,i=!1,l=-1,s=e.length,u=s-1;++l<s;u=l)(e[l][o]<=t[o]&&t[o]<e[u][o]||e[u][o]<=t[o]&&t[o]<e[l][o])&&t[r]<(e[u][r]-e[l][r])*(t[o]-e[l][o])/(e[u][o]-e[l][o])+e[l][r]&&(i=!i);return i},isPointInCircle:function(t,e,a){return n.getDistance(t,e)<a},getRhumbLineBearing:function(t,e){var a=n.getKeys(t),r=a.latitude,o=a.longitude,i=n.useDecimal(e[o]).toRad()-n.useDecimal(t[o]).toRad(),l=Math.log(Math.tan(n.useDecimal(e[r]).toRad()/2+Math.PI/4)/Math.tan(n.useDecimal(t[r]).toRad()/2+Math.PI/4));return Math.abs(i)>Math.PI&&(i=i>0?-1*(2*Math.PI-i):2*Math.PI+i),(Math.atan2(i,l).toDeg()+360)%360},getBearing:function(t,e){var a=n.getKeys(t),r=a.latitude,o=a.longitude;return e[r]=n.useDecimal(e[r]),e[o]=n.useDecimal(e[o]),t[r]=n.useDecimal(t[r]),t[o]=n.useDecimal(t[o]),(Math.atan2(Math.sin(e[o].toRad()-t[o].toRad())*Math.cos(e[r].toRad()),Math.cos(t[r].toRad())*Math.sin(e[r].toRad())-Math.sin(t[r].toRad())*Math.cos(e[r].toRad())*Math.cos(e[o].toRad()-t[o].toRad())).toDeg()+360)%360},getCompassDirection:function(t,e,a){var r;if("circle"==a)var o=n.getBearing(t,e);else o=n.getRhumbLineBearing(t,e);switch(Math.round(o/22.5)){case 1:r={exact:"NNE",rough:"N"};break;case 2:r={exact:"NE",rough:"N"};break;case 3:r={exact:"ENE",rough:"E"};break;case 4:r={exact:"E",rough:"E"};break;case 5:r={exact:"ESE",rough:"E"};break;case 6:r={exact:"SE",rough:"E"};break;case 7:r={exact:"SSE",rough:"S"};break;case 8:r={exact:"S",rough:"S"};break;case 9:r={exact:"SSW",rough:"S"};break;case 10:r={exact:"SW",rough:"S"};break;case 11:r={exact:"WSW",rough:"W"};break;case 12:r={exact:"W",rough:"W"};break;case 13:r={exact:"WNW",rough:"W"};break;case 14:r={exact:"NW",rough:"W"};break;case 15:r={exact:"NNW",rough:"N"};break;default:r={exact:"N",rough:"N"}}return r},orderByDistance:function(t,e){var a=n.getKeys(t),r=a.latitude,o=a.longitude,i=[];for(var l in e){var s=n.getDistance(t,e[l]);i.push({key:l,latitude:e[l][r],longitude:e[l][o],distance:s})}return i.sort(function(t,e){return t.distance-e.distance})},findNearest:function(t,e,a){return a=a||0,n.orderByDistance(t,e)[a]},getPathLength:function(t){for(var e,a=0,r=0,o=t.length;r<o;++r)e&&(a+=n.getDistance(t[r],e)),e=t[r];return a},getElevation:function(){void 0!==t.navigator?n.getElevationClient.apply(this,arguments):n.getElevationServer.apply(this,arguments)},getElevationClient:function(e,a){if(!t.google)throw new Error("Google maps api not loaded");if(0==e.length)return a(null,null);if(1==e.length)return a(new Error("getElevation requires at least 2 points."));for(var r=[],o=n.getKeys(e[0]),i=o.latitude,l=o.longitude,s=0;s<e.length;s++)r.push(new google.maps.LatLng(n.useDecimal(e[s][i]),n.useDecimal(e[s][l])));var u={path:r,samples:r.length};(new google.maps.ElevationService).getElevationAlongPath(u,function(t,r){n.elevationHandler(t,r,e,o,a)})},getElevationServer:function(t,e){if(0==t.length)return e(null,null);if(1==t.length)return e(new Error("getElevation requires at least 2 points."));var a=require("googlemaps"),r=[],o=n.getKeys(t[0]);t[0];for(var i=o.latitude,l=o.longitude,s=0;s<t.length;s++)r.push(n.useDecimal(t[s][i])+","+n.useDecimal(t[s][l]));a.elevationFromPath(r.join("|"),r.length,function(a,r){n.elevationHandler(r.results,r.status,t,o,e)})},elevationHandler:function(t,e,a,n,r){var o=[],i=n.latitude,l=n.longitude;if("OK"==e){for(var s=0;s<t.length;s++)o.push({lat:a[s][i],lng:a[s][l],elev:t[s].elevation});r(null,o)}else r(new Error("Could not get elevation using Google's API"),elevationResult.status)},getGrade:function(t){var e=n.getKeys(t[0]).elevation,a=Math.abs(t[t.length-1][e]-t[0][e]),r=n.getPathLength(t);return Math.floor(a/r*100)},getTotalElevationGainAndLoss:function(t){for(var e=n.getKeys(t[0]).elevation,a=0,r=0,o=0;o<t.length-1;o++){var i=t[o][e]-t[o+1][e];i>0?r+=i:a+=Math.abs(i)}return{gain:a,loss:r}},convertUnit:function(t,e,a){if(0==e||void 0===e){if(0==n.distance)return 0;e=n.distance}switch(a=null==a?4:a,t=t||"m"){case"m":return n.round(e,a);case"km":return n.round(e/1e3,a);case"cm":return n.round(100*e,a);case"mm":return n.round(1e3*e,a);case"mi":return n.round(e*(1/1609.344),a);case"sm":return n.round(e*(1/1852.216),a);case"ft":return n.round(e*(100/30.48),a);case"in":return n.round(100*e/2.54,a);case"yd":return n.round(e*(1/.9144),a)}return e},useDecimal:function(t){if(t=t.toString().replace(/\s*/,""),isNaN(parseFloat(t))||parseFloat(t).toString()!=t){if(1==n.isSexagesimal(t))return parseFloat(n.sexagesimal2decimal(t));throw"Unknown format."}return parseFloat(t)},decimal2sexagesimal:function(t){if(t in n.sexagesimal)return n.sexagesimal[t];var e=t.toString().split("."),a=Math.abs(e[0]),r=60*("0."+e[1]),o=r.toString().split(".");return r=Math.floor(r),o=(60*("0."+o[1])).toFixed(2),n.sexagesimal[t]=a+"Â° "+r+"' "+o+'"',n.sexagesimal[t]},sexagesimal2decimal:function(t){if(t in n.decimal)return n.decimal[t];var e=new RegExp(a).exec(t);if(e)var r=parseFloat(e[2]/60),o=parseFloat(e[4]/3600)||0;var i=(parseFloat(e[1])+r+o).toFixed(8);return i="S"==e[7]||"W"==e[7]?-1*i:i,n.decimal[t]=i,i},isSexagesimal:function(t){return a.test(t)},round:function(t,e){var a=Math.pow(10,e);return Math.round(t*a)/a}};void 0===Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),void 0===Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),void 0!==t.navigator?t.geolib=n:module.exports=n}(this);